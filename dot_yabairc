#!/usr/bin/env sh

# ------------------------------
# yabai 基础初始化
# ------------------------------
/opt/homebrew/bin/yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
sudo /opt/homebrew/bin/yabai --load-sa
yabai -m signal --add event=window_focused action="sketchybar --trigger window_focus"

# 通用布局设置
yabai -m config external_bar all:35:0
yabai -m config layout bsp
yabai -m config window_placement second_child
yabai -m config mouse_follows_focus off
yabai -m config focus_follows_mouse off
yabai -m config auto_balance off
yabai -m config split_ratio 0.50
yabai -m config window_gap 8
yabai -m config top_padding 5
yabai -m config bottom_padding 8
yabai -m config left_padding 8
yabai -m config right_padding 8
yabai -m config window_opacity off
yabai -m config menubar_opacity 0.0

# 鼠标操作
yabai -m config mouse_modifier fn
yabai -m config mouse_action1 move
yabai -m config mouse_action2 resize
yabai -m config mouse_drop_action swap

# ------------------------------
# 显示器 1 布局（主显示器）
# ------------------------------

# 桌面 1: 杂项（默认 manage=on）
yabai -m rule --add space=1 display=1 manage=on

# 桌面 2: 聊天工具（QQ、微信、Slack、Discord）
yabai -m rule --add app="^QQ$" space=2 display=1 manage=on
yabai -m rule --add app="^微信$" space=2 display=1 manage=on
yabai -m rule --add app="^Slack$" space=2 display=1 manage=on
yabai -m rule --add app="^Discord$" space=2 display=1 manage=on

# 桌面 3: 终端
yabai -m rule --add app="^Alacritty$" space=3 display=1 manage=on

# 桌面 4: 浏览器
yabai -m rule --add app="^Arc$" space=4 display=1 manage=on

# 桌面 5: IDE（JetBrains 系）
for ide in "GoLand" "IntelliJ IDEA" "PyCharm" "WebStorm" "CLion" "Rider"; do
	yabai -m rule --add app="^${ide}$" space=5 display=1 manage=on
done

# ------------------------------
# 显示器 2 布局（副显示器）
# ------------------------------

# 桌面 1: 音乐 + Lark
yabai -m rule --add app="^QQ音乐$" space=1 display=2 manage=on
yabai -m rule --add app="^网易云音乐$" space=1 display=2 manage=on
yabai -m rule --add app="^Lark$" space=1 display=2 manage=on

# 桌面 2: 办公类（ChatGPT、Postman、Notion、Sublime Text）
yabai -m rule --add app="^ChatGPT$" space=2 display=2 manage=on
yabai -m rule --add app="^Postman$" space=2 display=2 manage=on
yabai -m rule --add app="^Notion$" space=2 display=2 manage=on
yabai -m rule --add app="^Sublime Text$" space=2 display=2 manage=on

# ------------------------------
# 不纳入管理的系统窗口
# ------------------------------
yabai -m rule --add app="^(System Preferences|System Settings|App Store|Activity Monitor|Archive Utility|Dictionary|LuLu|Calculator|VLC|zoom.us)$" manage=off
yabai -m rule --add app="^Finder$" title="(Co(py|nnect)|Move|Info|Pref)" manage=off

# ------------------------------
# 特殊例外
# ------------------------------
yabai -m rule --add app="Alacritty" title="^dropdown-alacritty$" manage=off
yabai -m rule --add app="^Obsidian$" manage=off float=on sticky=on topmost=on

echo "✅ yabai configuration loaded for dual-display setup"
